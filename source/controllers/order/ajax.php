<?phpdefined('IN_SYSTEM') or exit('Access Denied');set_time_limit(0);ignore_user_abort();$ajax = array();switch ($this->s) {	case 'order':		$detail = $post['data'];		$detail['amount'] = intval($detail['amount']);		$detail['itemid'] = intval($detail['itemid']);		$pm = $detail['pm'];		$proMod = $MODULE[$pm];		if ($proMod['model'] != "product") {			$ajax['status'] = 0;			$ajax['text'] = "订单参数错误！";			break;		}		$product = $this->getProduct($proMod, $detail['itemid']);		if (!$product) {			$ajax['status'] = 0;			$ajax['text'] = "订单参数错误！";			break;		}		if ($detail['amount'] >= $product['minbuy'] && $detail['phonenum'] && $detail['cardneg'] && $detail['cardpos'] && $detail['account']) {			$proxy = 0;			if ($USER['uid'] > 0 && $USER['gid'] == 1) {				$price = $product['proprice'];			} else {				$price = $product['price'];				$hoo = $this->comm->getCookie("hoo");				$hoo = intval($hoo);				if ($hoo > 0) {					$proxy = $hoo;				}			}			$mod = $detail['mod'];			$mod = $MODULE[$detail['pm']]['mid'] ? $mod : $m;			$data = array(				"uid" => $USER['uid'] > 0 ? $USER['uid'] : 0,				"mod" => $proMod['module'],				"mid" => $proMod['mid'],				"itemid" => $product['id'],				"itemtitle" => $product['title'],				"itemname" => $product['itemname'],				"itemlink" => $URL->setUrl("?m={$proMod['module']}&ac=show&itemid={$product['id']}"), //$product['itemname'],				"jiaoyisuo" => $product['jiaoyisuo'], //交易所id				"proxy" => $proxy,				"cosprice" => $product['cosprice'], //成本价				"oriprice" => $product['price'], //原价				"proprice" => $product['proprice'], //推广价				"unitprice" => $price, //实际订单单价				"totalprice" => $price * $detail['amount'], //订单总价				"cardpos" => $detail['cardpos'], //身份证正面				"cardneg" => $detail['cardneg'], //身份证反面				"phonenum" => $detail['phonenum'], //手机号				"amount" => $detail['amount'], //订购数量				"account" => $detail['account'], //交易所账号				"ip" => getip(), //留言内容			);			/* 记录推广员信息，登陆过的会员将不记录 * */			$hoo = $this->comm->getCookie("hoo");			$hoo = intval($hoo);			if ($hoo > 0 && !$USER) {				$data['proxy'] = $hoo;			}			/**/			$ajax['orderid'] = $this->addItem($data);			if ($ajax['orderid']) {				$ajax['status'] = 1;				$ajax['text'] = "订单创建成功";			} else {				$ajax['status'] = 0;				$ajax['text'] = "订单创建失败";			}		} else {			if ($detail['amount'] < $product['minbuy']) {				$ajax['status'] = 0;				$ajax['text'] = "不能低于最低认购份额！";			} elseif (!$detail['phonenum']) {				$ajax['status'] = 0;				$ajax['text'] = "请填写联系方式！";			} elseif (!$detail['account']) {				$ajax['status'] = 0;				$ajax['text'] = "请填写交易账号！";			} elseif (!$detail['cardneg'] || !$detail['cardpos']) {				$ajax['status'] = 0;				$ajax['text'] = "请上传身份信息！";			} else {				$ajax['status'] = 0;				$ajax['text'] = "订单参数错误！";			}		}		break;	case 'pay':		break;	default :		$ajax['text'] = "参数错误！"; //参数错误		$ajax['status'] = 0; //参数错误		break;}echo json_encode($ajax); //输出json结构的数据/* * This file was created by Liu Xianzhong*  This file has ended*/